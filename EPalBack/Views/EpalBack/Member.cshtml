<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

        <!-- Sidebar - Brand -->
        <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
            <div class="sidebar-brand-icon rotate-n-15">
                <i class="fas fa-laugh-wink"></i>
            </div>
            <div class="sidebar-brand-text mx-3">ePal 管理員</div>
        </a>

        <!-- Divider -->
        <hr class="sidebar-divider my-0">

        <!-- Nav Item - Dashboard -->
        <li class="nav-item">
            <a class="nav-link" href="index.html">
                <i class="fas fa-fw fa-tachometer-alt"></i>
                <span>儀錶板</span>
            </a>
        </li>

        <!-- Order Manager -->
        <li class="nav-item">
            <a class="nav-link" href="order.html">
                <i class="fas fa-fw fa-table"></i>
                <span>訂單管理</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="product.html">
                <i class="fas fa-fw fa-table"></i>
                <span>商品管理</span>
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="member.html">
                <i class="fas fa-fw fa-table"></i>
                <span>會員管理</span>
            </a>
        </li>
        <!-- Divider -->
        <hr class="sidebar-divider d-none d-md-block">

        <!-- Sidebar Toggler (Sidebar) -->
        <div class="text-center d-none d-md-inline">
            <button class="rounded-circle border-0" id="sidebarToggle"></button>
        </div>

    </ul>
    <!-- End of Sidebar -->
    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- Topbar -->
            <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
                <h3>會員管理</h3>
            </nav>
            <!-- End of Topbar -->
            <!-- Begin Page Content -->
            <div class="container-fluid">
                <main role="main" class="pb-3">
                    <div class="container-fluid">
                        <div id="app" v-cloak>
                            <div class="row">
                                <div class="col-12">
                                    <template>
                                        <b-breadcrumb :items="breadCrumbItems"></b-breadcrumb>
                                    </template>
                                </div>
                                <div class="col-12">
                                    <!-- <b-tabs content-class="pt-2 pb-2 px-2" fill v-model="tabIndex"> -->
                                    <b-tab active>
                                        <!-- <template #title>
                                                <b-icon icon="arrow-up-square-fill" aria-hidden="true"></b-icon>
                                                <strong>上架中商品</strong>
                                            </template>
                                            <b-row>
                                                <b-col lg="9" class="my-1"></b-col>
                                                <b-col lg="3" class="my-1">
                                                    <b-form-group label="關鍵字搜尋" label-for="filter-input"
                                                        label-cols-sm="4" label-align-sm="right" label-size="sm"
                                                        class="mb-0">
                                                        <b-input-group size="sm">
                                                            <b-form-input id="filter-input" v-model="filter"
                                                                type="search" placeholder="請輸入關鍵字">
                                                            </b-form-input>
                                                        </b-input-group>
                                                    </b-form-group>

                                                </b-col>
                                            </b-row> -->
                                        <b-row>
                                            <!-- <b-col lg="6" class="my-1">
                                                    <b-form-group label="分類" label-for="sort-by-select" label-cols-sm="3"
                                                        label-align-sm="right" label-size="sm" class="mb-0"
                                                        v-slot="{ ariaDescribedby }">
                                                        <b-input-group size="sm">
                                                            <b-form-select id="sort-by-select" v-model="sortBy" :options="sortOptions"
                                                                :aria-describedby="ariaDescribedby" class="w-75">
                                                                <template #first>
                                                                    <option value="">-- none --</option>
                                                                </template>
                                                            </b-form-select>

                                                            <b-form-select v-model="sortDesc" :disabled="!sortBy"
                                                                :aria-describedby="ariaDescribedby" size="sm" class="w-25">
                                                                <option :value="false">升序</option>
                                                                <option :value="true">降序</option>
                                                            </b-form-select>
                                                        </b-input-group>
                                                    </b-form-group>
                                                </b-col> -->
                                            <b-col lg="6" class="my-1">
                                                <b-form-group label="初始分類" label-for="initial-sort-select"
                                                              label-cols-sm="3" label-align-sm="right" label-size="sm"
                                                              class="mb-0">
                                                    <b-form-select id="initial-sort-select" v-model="sortDirection"
                                                                   :options="['asc', 'desc', 'last']" size="sm">
                                                    </b-form-select>
                                                </b-form-group>
                                            </b-col>
                                            <b-col lg="6" class="my-1">
                                                <b-form-group label="搜尋" label-for="filter-input" label-cols-sm="3"
                                                              label-align-sm="right" label-size="sm" class="mb-0">
                                                    <b-input-group size="sm">
                                                        <b-form-input id="filter-input" v-model="filter"
                                                                      type="search" placeholder="請輸入關鍵字"></b-form-input>

                                                        <b-input-group-append>
                                                            <b-button :disabled="!filter" @@click="filter = ''">
                                                                清空
                                                            </b-button>
                                                        </b-input-group-append>
                                                    </b-input-group>
                                                </b-form-group>
                                            </b-col>
                                            <b-col lg="6" class="my-1">
                                                <b-form-group v-model="sortDirection" label="過濾條件" label-cols-sm="3"
                                                              label-align-sm="right" label-size="sm" class="mb-0"
                                                              v-slot="{ ariaDescribedby }">
                                                    <b-form-checkbox-group v-model="filterOn"
                                                                           :aria-describedby="ariaDescribedby" class="mt-1">
                                                        <b-form-checkbox value="memberName">會員名稱</b-form-checkbox>
                                                        <b-form-checkbox value="memberPhone">會員電話</b-form-checkbox>
                                                        <b-form-checkbox value="memberRegEmail">
                                                            會員註冊信箱
                                                        </b-form-checkbox>
                                                    </b-form-checkbox-group>
                                                </b-form-group>
                                            </b-col>

                                        </b-row>



                                        <b-table v-if="tabIndex==0" :items="items" :fields="fields" responsive="sm"
                                                 stacked="md" show-empty small :per-page="perPage"
                                                 :current-page="currentPage" :filter="filter">
                                            <template #table-busy>
                                                <div class="text-center text-danger my-2">
                                                    <b-spinner class="align-middle"></b-spinner>
                                                    <strong>Loading...</strong>
                                                </div>
                                            </template>

                                            <template #cell(profilePicture)="row">
                                                <b-img-lazy class="pdlistimg" :src="row.item.profilePicture"
                                                            thumbnail>
                                                </b-img-lazy>
                                            </template>

                                            <template #cell(actions)="row">
                                                <!-- <b-button variant="Secondary" size="sm"
                                                        v-on:click="info(row.item, row.index, $event.target)"
                                                        class="mr-1 btn-secondary">
                                                        關於
                                                    </b-button> -->
                                                <b-button variant="infoM" size="sm"
                                                          v-on:click="infoM(row.item, row.index, $event.target)"
                                                          class="mr-1 btn-primary">
                                                    編輯
                                                </b-button>
                                                <b-button size="sm"
                                                          v-on:click="sendEmailInfo(row.item, row.index, $event.target)"
                                                          class="mr-1 btn-success">
                                                    寄信
                                                </b-button>
                                            </template>
                                        </b-table>
                                        <b-row class="">
                                            <b-col lg="6" class="ml-auto">
                                                <b-pagination v-model="currentPage" :total-rows="totalRows"
                                                              :per-page="perPage" align="fill" size="md" class="my-0">
                                                </b-pagination>
                                            </b-col>
                                            <b-col lg="3" class="my-1">
                                                <b-form-group label="每頁顯示筆數" label-for="per-page-select"
                                                              label-cols-sm="3" label-cols-lg="9" content-cols="3"
                                                              label-align-sm="right" label-size="sm" class="mb-0">
                                                    <b-form-select id="per-page-select" v-model="perPage"
                                                                   :options="pageOptions" size="sm"></b-form-select>
                                                </b-form-group>
                                            </b-col>
                                        </b-row>

                                        <!-- Info 編輯modal -->
                                        <b-modal :id="memberManageModel.id" :title="memberManageModel.title"
                                                 header-bg-variant="infoM" header-text-variant="light" hide-footer
                                                 size="lg" v-on:hidden="resetProductDetailsModel"
                                                 ref="my-modal"
                                                 scrollable>
                                            <!-- <template #default> -->
                                            <div v-if="isOnSaleBusy.DetailsBusy"
                                                 class="busy text-center text-danger my-2">
                                                <b-spinner class="align-middle"></b-spinner>
                                                <strong>Loading...</strong>
                                            </div>

                                            <!-- 商品明細卡片 -->
                                            <div class="details-body" v-if="!isOnSaleBusy.DetailsBusy">
                                                <div class="row" v-model="memberManageModel.fields">

                                                </div>

                                                <div class="row">
                                                    <div v-for="item in memberManageModel.fields"
                                                         :class="['field','mb-3',((item.key==='creatorImg' || item.key==='introduction')?'col-12':'col-6')]">
                                                        <h2 class="title">{{item.title}}</h2>
                                                        <!-- <div v-if="item.key==='creatorImg'">
                                                                <b-img-lazy v-bind="productDetailsimgProps"
                                                                    :src="item.value" class="pddetailsimg" thumbnail
                                                                    center>
                                                                </b-img-lazy>
                                                            </div> -->
                                                        <!-- <div class="content"
                                                                v-else-if="item.key==='introduction'"
                                                                v-html="item.value"></div> -->
                                                        <!-- <p v-else class="content">{{item.value}}</p> -->
                                                        <input :readonly="item.readonlys" v-model="item.value"
                                                               class="form-control" type="text">
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- </template> -->
                                            <div class="modal-footer my-3">
                                                <button type="button" class="btn btn-secondary"
                                                        @@click="hideModal">
                                                    取消
                                                </button>
                                                <button v-on:click="UpdateMember" type="button"
                                                        class="btn btn-primary">
                                                    更新
                                                </button>
                                            </div>
                                        </b-modal>

                                        <!-- emailInfoModal寄信樣板的資料結構 -->
                                        <b-modal :id="emailInfoModal.id" :title="emailInfoModal.title" ok-title="寄信"
                                                 @@ok="handleEmailOk" cancel-title="取消" @@show="resetEmailInfoModal"
                                                 @@hide="resetEmailInfoModal">

                                            <b-card-text>收件信箱:{{emailInfoModal.emailReceiver}}</b-card-text>
                                            <form ref="form" submit.stop.prevent="emailSubmit" class="edit-form">
                                                <b-form-group label="信件標題"
                                                              label-for="emailInfoModal.emailTitle-input"
                                                              invalid-feedback="此為必填選項"
                                                              :state="emailInfoModalemailTitleState">
                                                    <b-form-input id="emailInfoModal.emailTitle-input"
                                                                  :state="emailInfoModalemailTitleState"
                                                                  v-model="emailInfoModal.emailTitle" placeholder="請輸入標題"
                                                                  required></b-form-input>
                                                </b-form-group>
                                                <b-form-group label="信件內容"
                                                              label-for="emailInfoModal.emailBody-input"
                                                              invalid-feedback="此為必填選項" :state="emailInfoModalemailBodyState">
                                                    <b-form-textarea id="emailInfoModal.emailBody-input"
                                                                     v-model="emailInfoModal.emailBody" placeholder="請輸入內容"
                                                                     rows="3" :state="emailInfoModalemailBodyState" max-rows="6"
                                                                     required></b-form-textarea>
                                                </b-form-group>
                                            </form>
                                        </b-modal>

                                    </b-tab>
                                    <b-tab>
                                        <!-- <template #title>
                                                <b-icon icon="arrow-down-square-fill" aria-hidden="true"></b-icon>
                                                <strong>已下架商品</strong>
                                            </template> -->
                                        <b-row>
                                            <b-col lg="9" class="my-1"></b-col>
                                            <b-col lg="3" class="my-1">
                                                <b-form-group label="關鍵字搜尋" label-for="filter-input"
                                                              label-cols-sm="4" label-align-sm="right" label-size="sm"
                                                              class="mb-0">
                                                    <b-input-group size="sm">
                                                        <b-form-input id="filter-input" v-model="filter"
                                                                      type="search" placeholder="請輸入關鍵字">
                                                        </b-form-input>
                                                    </b-input-group>
                                                </b-form-group>
                                            </b-col>
                                        </b-row>
                                        <!-- Main table element -->
                                        <!-- <b-table v-if="tabIndex==1" :items="items" :fields="fields"
                                                :current-page="currentPage" :per-page="perPage" :filter="filter"
                                                :filter-included-fields="filterOn" :sort-by.sync="sortBy"
                                                :sort-desc.sync="sortDesc" responsive="sm"
                                                :sort-direction="sortDirection" stacked="md" show-empty small
                                                :busy="isNonSaleBusy.PageBusy" v-on:filtered=""> -->
                                        <b-table v-if="tabIndex==1" :items="items" :fields="fields">
                                            <template #table-busy>
                                                <div class="text-center text-danger my-2">
                                                    <b-spinner class="align-middle"></b-spinner>
                                                    <strong>Loading...</strong>
                                                </div>
                                            </template>



                                            <template #cell(productImg)="row">
                                                <b-img-lazy v-bind="simplifyproductimgProps" class="pdlistimg"
                                                            :src="row.item.productImg" thumbnail>
                                                </b-img-lazy>
                                            </template>

                                            <template #cell(actions)="row">
                                                <b-button variant="primary" size="sm"
                                                          v-on:click="ProductModify(row.item.productId)" class="mr-1">
                                                    商品編輯
                                                </b-button>
                                                <b-button variant="success" size="sm"
                                                          v-on:click="ShowUpdateSaleConfirm(row.item.productId,SalesConfirmBoxProps.onSale)"
                                                          class="mr-1">
                                                    商品上架
                                                </b-button>
                                            </template>
                                        </b-table>

                                        <b-row>
                                            <b-col lg="6" class="ml-auto">
                                                <b-pagination v-model="currentPage" :total-rows="totalRows"
                                                              :per-page="perPage" align="fill" size="md" class="my-0">
                                                </b-pagination>
                                            </b-col>
                                            <b-col lg="3" class="my-1">
                                                <b-form-group label="每頁顯示筆數" label-for="per-page-select"
                                                              label-cols-sm="3" label-cols-lg="9" content-cols="3"
                                                              label-align-sm="right" label-size="sm" class="mb-0">
                                                    <b-form-select id="per-page-select" v-model="perPage"
                                                                   :options="pageOptions" size="sm"></b-form-select>
                                                </b-form-group>
                                            </b-col>
                                        </b-row>

                                    </b-tab>
                                    </b-tabs>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
            <!-- /.container-fluid -->
        </div>
        <!-- End of Main Content -->
        <!-- Footer -->
        <footer class="sticky-footer bg-white">
            <div class="container my-auto">
                <div class="copyright text-center my-auto">
                    <span>Copyright &copy; Your Website 2020</span>
                </div>
            </div>
        </footer>
        <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->
<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>

<!-- Logout Modal-->
<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"></span>
                </button>
            </div>
            <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                <a class="btn btn-primary" href="login.html">Logout</a>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap core JavaScript-->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Core plugin JavaScript-->
<script src="vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Custom scripts for all pages-->
<script src="js/sb-admin-2.min.js"></script>
<!-- toastr -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<!-- Axios -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
        integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
        crossorigin="anonymous"></script>

@section topCSS
{
    <style>
        .nav-tabs .nav-item.show .nav-link,
        .nav-tabs .nav-link.active {
            color: #28a745;
        }

        #app .tab-content {
            background-color: #fff;
            border-left: 1px solid #dee2e6;
            border-right: 1px solid #dee2e6;
            border-bottom: 1px solid #dee2e6;
        }

        .breadcrumb {
            padding: 0 0 0 0px;
            background-color: transparent;
            font-size: 0.875rem;
        }

        .pdlistimg {
            width: 60px;
            height: 60px;
        }
    </style>
}

@section endJS{
    <script>
        let app = new Vue({
            el: '#app',
            data: {
                items: [],
                fields: [
                    { key: 'memberId', label: '編號', sortable: true, sortDirection: 'desc' },
                    { key: 'profilePicture', label: '頭像', sortable: false, sortDirection: 'desc' },
                    { key: 'memberName', label: '會員名稱', sortable: true, sortDirection: 'desc' },
                    { key: 'phone', label: '手機', sortable: true, sortDirection: 'desc' },
                    { key: 'email', label: '註冊信箱', class: 'text-center' },
                    { key: 'backRegistDate', label: '註冊日期', class: 'text-center', sortable: true, sortDirection: 'desc' },
                    { key: 'actions', label: '會員管理' },

                ],
                currentitem: null,
                tabIndex: 0,
                totalRows: 1,
                currentPage: 1,
                perPage: 5,
                pageOptions: [5, 10, 20],
                sortBy: '',
                sortDesc: false,
                //預設排序順序 小 -> 大
                sortDirection: 'asc',
                filter: null,
                filterOn: [],
                currentMember: [],
                productDetailsModel: {
                    id: 'product-details-modal',
                    fields: [
                        { key: 'memberName', title: '商品姓名', value: '' },
                        { key: 'memberId', title: '會員編號', value: '' },
                        { key: 'profilePicture', title: '玩家圖片', value: '' },
                        { key: 'phone', title: '手機', value: '' },
                        { key: 'email', title: '註冊信箱', value: '' },
                    ]
                },
                memberManageModel: {
                    id: 'product-details-modal',
                    fields: [
                        { key: 'memberName', title: '商品姓名', value: '', },
                        { key: 'memberId', title: '會員編號', value: '', readonlys: 'false' },
                        // { key: 'profilePicture', title: '玩家圖片', value: '' },
                        { key: 'phone', title: '手機', value: '' },
                        { key: 'email', title: '註冊信箱', value: '' },
                        { key: 'country', title: '國家', value: '' },

                    ]
                },
                /*儲存寄件資料的變數*/
                emailInfoModal: {
                    id: 'emailInfo-modal',
                    title: '寄信給會員編號XX',
                    memberId: '6666',
                    emailReceiver: '1234@gmail.com',
                    emailTitle: '信件標題內容12345',
                    emailBody: '信件內容54321',
                },
                /*寄件輸入欄位的基本判斷*/
                emailInfoModalemailTitleState: null,
                emailInfoModalemailBodyState: null,
                /*寄件資料AJAX發送的儲存物件*/
                sendEmail: { MailBody: "", ToEmail: "", Subject: "" },

                //描述頁面是否忙碌中，EX:進行非同步作業
                isOnSaleBusy: { PageBusy: false, DetailsBusy: false },
                isNonSaleBusy: { PageBusy: false, DetailsBusy: false },

                // url列表
                urlList: {
                    simplifyproductsOnSale: 'http://localhost:34800/api/product/getallproduct',
                    // simplifyproductNonSale: 'http://localhost:34800/api/product/getallproduct',
                    productDetails: 'http://localhost:34800/api/product/getproductDetails',
                    memberManages: 'http://localhost:34800/api/Member/GetMemberManage',
                    // memberManages: 'http://localhost:34800/api/Member/GetMemberManage',
                    memberFeebackEmail: 'http://localhost:34800/api/Member/PostMemberEmail'


                },

                //麵包屑
                breadCrumbItems: [
                    {
                        text: '首頁',
                        href: 'index.html'
                    },
                    {
                        text: '會員列表',
                        active: true
                    }
                ],
                productDetailsimgProps: {
                    blank: true,
                    blankColor: '#bbb',
                    width: 240,
                    height: 340
                },
            },
            //商品明細圖片延遲載入的參數

            created() {
                //初始化頁面
                this.tabIndex = 0;
                this.getAllMember();
            },
            watch: {
                tabIndex: function () {
                    switch (this.tabIndex) {
                        case 0:
                            break;
                        case 1:
                            break;
                        default:
                            break;
                    }
                },
                items: function () {
                    this.totalRows = this.items.length;
                }
            },
            methods: {
                //取得所有會員
                getAllMember() {
                    this.SetPageDefault();
                    axios.get('http://localhost:34800/api/Member/GetMembers')
                        .then(res => {
                            if (res.data.status == 0) {
                                this.items = res.data.result;
                                console.log(res.data.result)
                            }
                        })
                },
                /*emailInfoModal寄信樣板的資料結構*/
                sendEmailInfo(item, index, button) {
                    // this.emailInfoModal.title =
                    // this.emailInfoModal.emailReceiver = item.memberRegEmail;
                    this.emailInfoModal.title = `寄信給會員編號: ${JSON.stringify(item.memberId, null, 2)}`;
                    this.emailInfoModal.emailReceiver = item.email;
                    // console.log(item.email);
                    console.log(this.emailInfoModal.emailReceiver);
                    this.emailInfoModal.memberId = item.memberId,
                        console.log(item.memberId);
                    this.$root.$emit('bv::show::modal', this.emailInfoModal.id, button)
                },
                UpdateMember() {
                    axios.post('')


                },

                hideModal() {
                    this.$refs['my-modal'].hide()
                },

                //取得所有商品
                getAllProduct() {
                    this.SetPageDefault();
                    axios.get('http://localhost:34800/api/product/getallproduct')
                        .then(res => {
                            if (res.data.status == 0) {
                                this.items = res.data.result;
                                console.log(res.data.result)
                            }
                        })
                },

                //設定頁面初始狀態
                SetPageDefault() {
                    this.items = [];
                    this.totalRows = 1;
                    this.currentPage = 1;
                    this.perPage = 5;
                    this.sortBy = '';
                    this.sortDesc = false;
                    this.filter = null;
                },

                //切換上架商品頁
                OnSalePage() {
                    this.SetPageDefault()
                },

                //切換下架商品頁
                NonSalePage() {
                    // console.log('Nonsalepage');
                    this.SetPageDefault();

                },

                //取得簡化版的商品
                getSimplifyProducts(uri, busyobj, onsale) {
                    busyobj.PageBusy = true;
                    let cfg = {
                        method: 'get',
                        headers: {
                            'Content-type': 'application/json',
                        },
                        url: uri
                    };
                    axios(cfg)
                        .then(res => {
                            if (Array.isArray(res.data.result) && res.status == 200) {

                                switch (res.data.status) {
                                    case 0:
                                        this.items = this.SimplifyProductDataProc(res.data.result, onsale);
                                        break;
                                    default:
                                        console.warn(res);
                                        break;
                                }
                            }
                            else {
                                throw new UserException('Unknown Error');
                            }
                        })
                        .catch(err => {
                            if (err.response.status === 401) {
                                LoginInvalidRedirect();
                            }
                            console.dir(err);
                        })
                        .finally(() => {
                            busyobj.PageBusy = false;
                        });
                },



                //取得商品明細
                getProductDetails(uri, id) {
                    let cfg = {
                        method: 'get',
                        headers: {
                            'Content-type': 'application/json',
                        },
                        url: `${uri}/${id}`
                    };
                    console.log(cfg)
                    return axios(cfg);
                },

                //編輯會員明細
                getMemberManage(uri, id) {
                    let cfg = {
                        method: 'get',
                        headers: {
                            'Content-type': 'application/json',
                        },
                        url: `${uri}/${id}`
                    };
                    console.log(cfg)
                    return axios(cfg);
                },

                //編輯會員明細
                async infoM(item, index, button) {
                    try {
                        this.isOnSaleBusy.DetailsBusy = true;
                        this.memberManageModel.title = `商品明細 - ID：${item.memberId}`
                        this.$root.$emit('bv::show::modal', this.productDetailsModel.id, button);
                        let response = await this.getMemberManage(this.urlList.memberManages, item.memberId)

                        if (response.status == 200) {
                            let data = response.data.result;
                            let newdata = data[0]
                            console.log(newdata)
                            for (let item of this.memberManageModel.fields) {

                                item.value = `$${(newdata[item.key])}.0`;
                                let temp = newdata[`${item.key}`];
                                item.value = (temp != '') ? temp : '無'

                            }
                        }
                        else {
                            throw new UserException('UnKnown Error')
                        }
                    } catch (err) {

                        console.log(err);
                    } finally {
                        this.isOnSaleBusy.DetailsBusy = false;
                    }
                },

                //寄信
                handleEmailOk() {
                    this.emailSubmit();
                },
                //重置寄信
                resetEmailInfoModal() {

                },
                //檢查寄信欄位是否符合規定
                checkFormValidity() {

                },
                //Post發送信件請求
                emailSubmit() {


                    this.sendEmail.mailTitle = this.emailInfoModal.emailTitle;
                    this.sendEmail.mailBody = this.emailInfoModal.emailBody;
                    this.sendEmail.ToEmail = this.emailInfoModal.emailReceiver;
                    // this.sendEmail.ToEmail = this.emailInfoModal.emailReceiver;
                    //  console.log(sendEmail.ToEmail);


                    var Data = JSON.stringify({
                        email: 'user@example.com',
                        password: 'string',
                        MailBody: this.sendEmail.mailBody,
                        // ToEmail: 'johnson1990hitachi@gmail.com',
                        ToEmail: this.sendEmail.ToEmail,
                        Subject: this.emailInfoModal.emailTitle,
                        // Subject: '12345'
                    });



                    $.ajax({
                        url: "http://localhost:34800/api/MemberEmail",
                        type: "POST",
                        data: Data,
                        async: true,
                        contentType: 'application/json; charset=utf-8',
                        processData: false,
                        //dataType: "json",
                        success: function (res) {
                            console.log(res);
                            console.log('寄信成功');
                            //$("#ShowMsg").text("Image Uploaded Successfully...!").css("color", "green")
                        },
                        error: function (err) {
                            console.log(err);
                            console.log('寄信失敗');
                            //$("#ShowMsg").text("Image Not Uploaded...!").css("color", "red")
                        }
                    });


                },

                //顯示商品明細
                async info(item, index, button) {
                    try {
                        this.isOnSaleBusy.DetailsBusy = true;
                        this.productDetailsModel.title = `商品明細 - ID：${item.memberId}`

                        this.$root.$emit('bv::show::modal', this.productDetailsModel.id, button);
                        let response = await this.getProductDetails(this.urlList.productDetails, item.memberId)


                        if (response.status == 200) {
                            let data = response.data.result;
                            let newdata = data[0]
                            console.log(newdata)
                            for (let item of this.productDetailsModel.fields) {
                                item.value = newdata[item.key];
                                let temp = newdata[`${item.key}`];
                                item.value = (temp != '') ? temp : '無'
                            }
                        }
                        else {
                            throw new UserException('UnKnown Error')
                        }
                    } catch (err) {

                        console.log(err);
                    } finally {
                        this.isOnSaleBusy.DetailsBusy = false;
                    }
                    // console.log(productDetailsModel);
                },




                resetProductDetailsModel() {
                    this.productDetailsModel.title = ''
                    this.productDetailsModel.fields.map(x => x.value = '');
                },

                ProductModify(id) {
                    window.location.href = `/Product/Modify/${id}`;
                }
            }
        })
    </script>

    <script>
        //價錢三位一點
        function CurrencyFormat(num) {
            var parts = num.toString().split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            return parts.join('.');
        }
        Vue.filter('CurrencyString', function (num = "") {
            var parts = num.toString().split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            return parts.join('.');
        });

        //日期時間格式化
        function DateFormat(value, format) {
            return moment(value).format(format || 'YYYY/MM/DD');
        }
        //日期格式化
        Vue.filter('DateString', function (value, format) {
            return moment(value).format(format || 'YYYY/MM/DD')
        });

        //超過指定內容長度以...取代
        function StringContentFormat(content, maxlength = 1) {
            if (maxlength <= 0 || content.length <= maxlength) {
                return content;
            }
            else {
                return content.substring(0, maxlength - 1) + '...';
            }
        }


        //取得圖片的解析度
        function GetImageDimensions(imageData) {
            return new Promise((resovle, reject) => {
                let img = new Image();
                img.onload = () => {
                    resovle({ width: img.width, height: img.height })
                }
                img.src = imageData;
            });
        }

        //取得Quill Instance
        function GetQuillInstance(selector) {

            let toolbaroptions = [
                ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
                ['link'],
                ['blockquote', 'code-block'],

                [{ 'header': 1 }, { 'header': 2 }],               // custom button values
                [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                [{ 'script': 'sub' }, { 'script': 'super' }],      // superscript/subscript
                [{ 'indent': '-1' }, { 'indent': '+1' }],          // outdent/indent

                [{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown
                [{ 'header': [1, 2, 3, 4, 5, 6, false] }],

                [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
                [{ 'font': [] }],
                [{ 'align': [] }],

                ['clean']                                         // remove formatting button
            ];

            return new Quill(selector, {
                modules: {
                    toolbar: toolbaroptions,
                },
                theme: 'snow'
            });
        }

        //取得URL的Blob資源
        function GetBlobResourceFromURL(url) {
            return axios({
                method: 'get',
                url: url,
                responseType: 'blob'
            })
                .then(res => {
                    return res.data;
                })
        }

        //檔案讀取
        function FileReaderByDataURL(file) {
            return new Promise((resolve, reject) => {
                let reader = new FileReader();
                reader.onload = (result) => {
                    resolve(result);
                }
                reader.readAsDataURL(file);
            })
        }

        function Byte2KiloByte(byte) {
            return Math.floor(byte / 1024);
        }
    </script>




}

